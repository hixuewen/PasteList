# PasteList 技术规格文档

## 1. 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | PasteList 技术规格文档 |
| 版本 | v1.0.0 |
| 编写日期 | 2025-11-30 |
| 项目类型 | 桌面应用程序 + 后端服务 |
| 目标平台 | Windows 10/11 (x64) |
| 开发技术 | .NET 8.0 + WPF + Node.js + Express |

## 2. 项目概述

### 2.1 项目背景
在日常工作中，用户经常需要频繁复制和粘贴各种内容，包括文本、链接、代码片段等。Windows 系统自带的剪贴板功能非常基础，只能保存最近一次复制的内容，无法满足用户对历史记录管理、快速搜索和跨设备同步的需求。

PasteList 旨在解决这一痛点，为用户提供一个功能强大、设计精美的剪贴板历史记录管理工具，帮助用户更高效地管理和使用剪贴板内容。

### 2.2 项目定位
PasteList 是一款基于 .NET 8.0 和 WPF 开发的剪贴板历史记录管理工具，采用 MVVM 架构模式，为用户提供高效、安全、便捷的剪贴板管理体验。

### 2.3 核心功能
- 实时监听剪贴板内容变化
- 防重复机制，智能过滤重复内容
- 多格式支持（文本、图片、文件等）
- 现代化用户界面，支持实时搜索
- 双击粘贴功能，智能切换到之前的活动窗口
- 全局快捷键支持
- 系统托盘集成
- 开机启动支持
- 跨设备数据同步

## 3. 系统架构

### 3.1 整体架构

```
┌───────────────────────────────────────────────────────────────────┐
│                         客户端应用 (WPF)                          │
├─────────────────┬─────────────────┬─────────────────┬─────────────┤
│      View       │   ViewModel     │     Model       │  Service    │
│                 │                 │                 │  Layer      │
├─────────────────┼─────────────────┼─────────────────┼─────────────┤
│ MainWindow.xaml │MainWindowVM.cs  │ ClipboardItem   │ Clipboard   │
│ SettingsWindow  │SettingsVM.cs    │ AppSettings     │ History     │
│                 │                 │                 │ Startup     │
│                 │                 │                 │ Sync        │
└─────────────────┴─────────────────┴─────────────────┴─────────────┘
                              │
                              ▼
┌───────────────────────────────────────────────────────────────────┐
│                         数据访问层                               │
├───────────────────────────────────────────────────────────────────┤
│                     Entity Framework Core                         │
└───────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌───────────────────────────────────────────────────────────────────┐
│                         本地数据库                               │
├───────────────────────────────────────────────────────────────────┤
│                          SQLite                                  │
└───────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌───────────────────────────────────────────────────────────────────┐
│                         网络通信层                               │
├───────────────────────────────────────────────────────────────────┤
│                          HTTP/HTTPS                               │
└───────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌───────────────────────────────────────────────────────────────────┐
│                         后端服务 (Node.js)                        │
├─────────────────┬─────────────────┬─────────────────┬─────────────┤
│   Controllers   │    Routes       │    Models       │  Middleware │
├─────────────────┼─────────────────┼─────────────────┼─────────────┤
│  AuthController │     auth.js     │     User        │    auth     │
│  ClipboardCtrl  │  clipboard.js   │ ClipboardItem   │ errorHandler│
│  DeviceCtrl     │   devices.js    │     Device      │ rateLimiter │
│  UserCtrl       │    users.js     │ RefreshToken    │  validator  │
└─────────────────┴─────────────────┴─────────────────┴─────────────┘
                              │
                              ▼
┌───────────────────────────────────────────────────────────────────┐
│                         云端数据库                               │
├───────────────────────────────────────────────────────────────────┤
│                        MongoDB/MySQL                             │
└───────────────────────────────────────────────────────────────────┘
```

### 3.2 客户端架构
- **MVVM 架构模式**：分离视图、视图模型和模型，提高代码可维护性和可测试性
- **服务层设计**：封装业务逻辑，提供清晰的 API 接口
- **数据访问层**：使用 Entity Framework Core 进行数据库操作
- **异步编程模型**：提高应用响应速度

### 3.3 服务端架构
- **RESTful API 设计**：遵循 REST 原则，提供标准化的接口
- **中间件机制**：实现认证、错误处理、请求频率限制等横切关注点
- **模块化设计**：按功能模块划分代码，便于维护和扩展
- **JWT 认证**：实现无状态的身份验证机制

## 4. 技术选型

### 4.1 客户端技术栈

| 技术/框架 | 版本 | 用途 |
|-----------|------|------|
| .NET | 8.0 | 应用开发框架 |
| WPF | - | 桌面应用 UI 框架 |
| Entity Framework Core | 9.0.8 | ORM 框架 |
| SQLite | - | 本地数据库 |
| Hardcodet.NotifyIcon.Wpf | 最新稳定版 | 系统托盘组件 |
| Newtonsoft.Json | 最新稳定版 | JSON 序列化 |

### 4.2 服务端技术栈

| 技术/框架 | 版本 | 用途 |
|-----------|------|------|
| Node.js | 18.x+ | 服务端运行环境 |
| Express | 4.x+ | Web 应用框架 |
| JWT | 最新稳定版 | 身份验证 |
| MongoDB/MySQL | 最新稳定版 | 云端数据库 |
| bcrypt | 最新稳定版 | 密码哈希 |
| cors | 最新稳定版 | 跨域资源共享 |
| helmet | 最新稳定版 | 安全增强 |
| rate-limiter-flexible | 最新稳定版 | 请求频率限制 |

## 5. 数据模型

### 5.1 本地数据模型

#### 5.1.1 ClipboardItem（剪贴板项）

| 字段名 | 类型 | 描述 |
|--------|------|------|
| Id | int | 主键，自增 |
| Content | string | 剪贴板内容 |
| CreatedAt | DateTime | 创建时间 |
| UpdatedAt | DateTime | 更新时间 |
| IsFavorite | bool | 是否收藏 |
| SourceApp | string | 来源应用程序 |
| ContentType | string | 内容类型（文本、图片、文件等） |

#### 5.1.2 AppSettings（应用设置）

| 字段名 | 类型 | 描述 |
|--------|------|------|
| Key | string | 设置键 |
| Value | string | 设置值 |
| Type | string | 值类型（bool、int、string等） |

### 5.2 云端数据模型

#### 5.2.1 User（用户）

| 字段名 | 类型 | 描述 |
|--------|------|------|
| Id | int | 用户ID |
| Username | string | 用户名 |
| Email | string | 邮箱 |
| PasswordHash | string | 密码哈希 |
| CreatedAt | DateTime | 创建时间 |
| UpdatedAt | DateTime | 更新时间 |
| LastLoginAt | DateTime | 最后登录时间 |

#### 5.2.2 ClipboardItem（剪贴板项）

| 字段名 | 类型 | 描述 |
|--------|------|------|
| Id | int | 剪贴板项ID |
| Content | string | 内容 |
| UserId | int | 用户ID |
| DeviceId | string | 设备ID |
| CreatedAt | DateTime | 创建时间 |
| UpdatedAt | DateTime | 更新时间 |

#### 5.2.3 Device（设备）

| 字段名 | 类型 | 描述 |
|--------|------|------|
| DeviceId | string | 设备唯一标识 |
| DeviceName | string | 设备名称 |
| DeviceType | string | 设备类型（desktop/mobile/tablet） |
| Platform | string | 操作系统平台 |
| LastActiveAt | DateTime | 最后活跃时间 |
| CreatedAt | DateTime | 创建时间 |

#### 5.2.4 RefreshToken（刷新令牌）

| 字段名 | 类型 | 描述 |
|--------|------|------|
| Id | int | 令牌ID |
| UserId | int | 用户ID |
| Token | string | 刷新令牌 |
| ExpiresAt | DateTime | 过期时间 |
| CreatedAt | DateTime | 创建时间 |
| RevokedAt | DateTime | 撤销时间（可选） |

## 6. 接口定义

### 6.1 通用说明

- **基础URL**: `https://api.pastelist.com/api/v1`
- **认证方式**: JWT Bearer Token
- **数据格式**: JSON
- **请求头**: Content-Type: application/json, Accept: application/json
- **认证头**: Authorization: Bearer {access_token}

### 6.2 用户认证接口

| 接口 | 方法 | 路径 | 描述 |
|------|------|------|------|
| 用户注册 | POST | /auth/register | 注册新用户账号 |
| 用户登录 | POST | /auth/login | 用户登录，获取访问令牌 |
| 刷新令牌 | POST | /auth/refresh | 使用刷新令牌获取新的访问令牌 |
| 用户登出 | POST | /auth/logout | 注销当前登录会话，使令牌失效 |
| 验证令牌 | GET | /auth/validate | 验证当前访问令牌是否有效 |

### 6.3 用户信息接口

| 接口 | 方法 | 路径 | 描述 |
|------|------|------|------|
| 获取当前用户信息 | GET | /users/me | 获取当前登录用户的详细信息 |
| 更新用户信息 | PUT | /users/me | 更新当前用户的个人信息 |
| 修改密码 | POST | /users/me/password | 修改当前用户密码 |

### 6.4 剪贴板数据接口

| 接口 | 方法 | 路径 | 描述 |
|------|------|------|------|
| 上传剪贴板项 | POST | /clipboard/items | 上传本地剪贴板数据到服务器 |
| 批量上传剪贴板项 | POST | /clipboard/items/batch | 批量上传多个剪贴板项 |
| 获取剪贴板项列表 | GET | /clipboard/items | 获取当前用户的剪贴板历史记录 |
| 获取单个剪贴板项 | GET | /clipboard/items/{id} | 根据ID获取特定剪贴板项的详细信息 |
| 更新剪贴板项 | PUT | /clipboard/items/{id} | 更新指定剪贴板项的内容 |
| 删除剪贴板项 | DELETE | /clipboard/items/{id} | 删除指定的剪贴板项 |
| 同步剪贴板数据 | POST | /clipboard/sync | 双向同步剪贴板数据 |

### 6.5 设备管理接口

| 接口 | 方法 | 路径 | 描述 |
|------|------|------|------|
| 获取设备列表 | GET | /devices | 获取当前用户的所有设备信息 |
| 移除设备 | DELETE | /devices/{deviceId} | 移除指定设备的访问权限 |

## 7. 安全规范

### 7.1 客户端安全

- **本地数据加密**: 敏感数据在本地存储时进行加密
- **安全存储**: 使用 Windows Credential Manager 存储敏感信息
- **防注入**: 所有用户输入进行严格验证和过滤
- **权限控制**: 仅请求必要的系统权限

### 7.2 服务端安全

- **HTTPS 要求**: 所有 API 请求必须通过 HTTPS 协议
- **TLS 版本**: 推荐使用 TLS 1.2 或更高版本
- **Token 安全**: Access Token 有效期 1小时/24小时，Refresh Token 有效期 7天/30天
- **密码安全**: 密码最小长度 8 个字符，包含大小写字母和数字，使用 BCrypt 或 Argon2 进行哈希存储
- **请求频率限制**: 登录/注册 5次/分钟/IP，Token刷新 10次/分钟/用户，数据同步 100次/小时/用户
- **数据验证**: 所有输入数据必须进行服务器端验证，防止 SQL 注入、XSS 攻击

### 7.3 数据安全

- **数据加密**: 敏感数据在传输和存储过程中进行加密
- **数据备份**: 定期备份用户数据
- **数据销毁**: 用户注销后，相关数据应在合理时间内销毁
- **隐私保护**: 遵循最小权限原则，仅收集必要的数据

## 8. 性能要求

### 8.1 客户端性能

| 性能指标 | 要求 |
|----------|------|
| 启动时间 | 从点击图标到主窗口显示不超过 2 秒 |
| 响应速度 | 搜索、双击粘贴等操作响应时间不超过 0.5 秒 |
| 内存占用 | 空闲状态下内存占用不超过 100MB |
| CPU 占用 | 正常运行时 CPU 占用率不超过 5% |
| 数据处理 | 能正常处理 10,000 条历史记录 |

### 8.2 服务端性能

| 性能指标 | 要求 |
|----------|------|
| 响应时间 | API 请求响应时间不超过 200ms |
| 并发处理 | 支持至少 1000 并发连接 |
| 数据存储 | 支持至少 100 万用户的数据存储 |
| 可用性 | 服务可用性不低于 99.9% |

## 9. 部署流程

### 9.1 客户端部署

#### 9.1.1 从源码构建

```bash
# 克隆仓库
git clone https://github.com/yourusername/PasteList.git
cd PasteList

# 恢复依赖
dotnet restore

# 构建项目
dotnet build --configuration Release

# 运行应用程序
dotnet run --configuration Release

# 发布应用程序
dotnet publish --configuration Release --output ./publish
```

#### 9.1.2 安装和运行

1. 下载发布版本的 `PasteList.zip`
2. 解压到任意文件夹
3. 运行 `PasteList.exe`
4. 首次运行时，应用会自动创建数据库和配置文件

### 9.2 服务端部署

#### 9.2.1 环境准备

- Node.js 18.x+ 环境
- MongoDB/MySQL 数据库
- 配置 `.env` 文件（参考 `.env.example`）

#### 9.2.2 安装和运行

```bash
# 进入服务端目录
cd Server

# 安装依赖
npm install

# 启动服务（开发模式）
npm run dev

# 启动服务（生产模式）
npm start
```

#### 9.2.3 容器化部署

```bash
# 构建镜像
docker build -t pastelist-api .

# 运行容器
docker run -d -p 3000:3000 --name pastelist-api pastelist-api
```

## 10. 开发规范

### 10.1 代码规范

- **命名规范**: 采用 PascalCase 命名类和方法，camelCase 命名变量和参数
- **注释规范**: 所有公共 API 都包含详细的 XML 文档注释
- **代码结构**: 遵循模块化设计，代码结构清晰，职责单一
- **错误处理**: 统一的错误处理机制，提供清晰的错误信息

### 10.2 版本控制

- 使用 Git 进行版本控制
- 采用语义化版本号（Major.Minor.Patch）
- 遵循 Git Flow 工作流
- 提交信息清晰、简洁，遵循 Conventional Commits 规范

### 10.3 测试规范

- 单元测试覆盖率不低于 80%
- 集成测试覆盖核心业务流程
- 自动化测试 CI/CD 集成
- 定期进行性能测试和安全测试

## 11. 维护与支持

### 11.1 日志管理

- 采用结构化日志格式
- 日志级别：Debug、Info、Warn、Error、Fatal
- 日志存储：本地文件 + 可选的远程日志服务
- 日志保留：至少保留 30 天的日志

### 11.2 监控与告警

- 客户端监控：应用崩溃报告、性能指标监控
- 服务端监控：API 响应时间、错误率、并发数、资源使用率
- 告警机制：设置阈值，超过阈值时发送告警通知

### 11.3 故障处理

- 建立故障响应流程
- 定期进行故障演练
- 详细记录故障原因和解决方案
- 持续改进，防止类似故障再次发生

## 12. 附录

### 12.1 术语定义

| 术语 | 解释 |
|------|------|
| MVVM | Model-View-ViewModel，一种软件架构模式 |
| JWT | JSON Web Token，一种用于身份验证的令牌格式 |
| SQLite | 一种轻量级嵌入式数据库 |
| RESTful API | 一种基于 HTTP 协议的 API 设计风格 |
| ORM | Object-Relational Mapping，对象关系映射 |
| TLS | Transport Layer Security，传输层安全协议 |

### 12.2 参考文档

- [.NET 8.0 官方文档](https://docs.microsoft.com/zh-cn/dotnet/core/whats-new/dotnet-8)
- [WPF 官方文档](https://docs.microsoft.com/zh-cn/dotnet/desktop/wpf/)
- [Entity Framework Core 官方文档](https://docs.microsoft.com/zh-cn/ef/core/)
- [JSON Web Token 官方文档](https://jwt.io/introduction/)
- [Express 官方文档](https://expressjs.com/)

### 12.3 联系方式

| 角色 | 联系方式 |
|------|----------|
| 项目负责人 | [负责人姓名] |
| 技术负责人 | [技术负责人姓名] |
| 开发团队 | [项目邮箱] |
| GitHub | [项目仓库地址] |

## 13. 版本历史

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| v1.0.0 | 2025-11-30 | 初始版本发布 |

---

**文档结束**

如有疑问或需要更新，请联系项目团队。